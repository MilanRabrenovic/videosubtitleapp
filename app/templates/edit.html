<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Edit Subtitles</title>
  <script src="/static/js/subtitles.js" defer></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    .subtitle-block { border: 1px solid #ddd; padding: 12px; margin-bottom: 12px; }
    .subtitle-row { display: flex; gap: 12px; margin-bottom: 8px; }
    .subtitle-row label { flex: 1; }
    textarea { width: 100%; min-height: 64px; }
    .actions { margin-top: 16px; display: flex; gap: 12px; flex-wrap: wrap; }
    .status { margin-top: 8px; color: #2b6cb0; }
  </style>
</head>
<body>
  <main>
    <h1>Edit Subtitles</h1>
    <p><strong>Job:</strong> {{ job.title }}</p>
    <p><strong>Video file:</strong> {{ job.video_filename }}</p>

    {% if saved %}
      <p class="status">Changes saved.</p>
    {% endif %}

    <form id="subtitle-form" action="/edit/{{ job.job_id }}" method="post">
      <input type="hidden" id="subtitles-json" name="subtitles_json" value="" />

      <div id="subtitle-list">
        {% for block in job.subtitles %}
          <div class="subtitle-block" data-index="{{ loop.index0 }}">
            <div class="subtitle-row">
              <label>
                Start time
                <input type="text" class="start" value="{{ block.start }}" />
              </label>
              <label>
                End time
                <input type="text" class="end" value="{{ block.end }}" />
              </label>
            </div>
            <label>
              Text
              <textarea class="text">{{ block.text }}</textarea>
            </label>
          </div>
        {% endfor %}
      </div>

      <div class="actions">
        <button type="submit">Save edits</button>
        <span id="save-status" class="status" style="display: none;">Subtitles saved</span>
      </div>
      <p id="timestamp-hint" class="status" style="display: none;">
        One or more timestamps look invalid (expected HH:MM:SS,mmm)
      </p>
      <p id="edit-status" class="status"></p>
    </form>

    <div class="actions">
      <form action="/export/{{ job.job_id }}/subtitles" method="post">
        <input type="hidden" name="format" value="srt" />
        <button type="submit" data-export="srt">Download subtitles (SRT)</button>
      </form>
      <form action="/export/{{ job.job_id }}/subtitles" method="post">
        <input type="hidden" name="format" value="vtt" />
        <button type="submit">Download subtitles (VTT)</button>
      </form>
      <form action="/export/{{ job.job_id }}/video" method="post">
        <button type="submit" data-export="video">Export video with subtitles</button>
      </form>
    </div>
    <p id="export-status" class="status" style="display: none;"></p>
    <p id="video-export-status" class="status" style="display: none;"></p>
    <p><em>Tip:</em> Save edits before exporting.</p>
  </main>
</body>
</html>
